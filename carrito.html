<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras | Rentfagelu</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/carrito.css">
    <link rel="stylesheet" href="css/estilo.css">
</head>

<body>
    <header>
        <nav>
            <div class="logo">
                <a href="index.html">Rentfagelu</a>
            </div>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="propiedades.html">Propiedades</a></li>
                <li><a href="nosotros.html">Nosotros</a></li>
                <li><a href="contacto.html">Contacto</a></li>
                <li><a href="carrito.html" class="cart-link">üõí Carrito <span class="cart-badge">0</span></a></li>
            </ul>
            <div class="user-actions">
                <a href="login.html" id="login-link">Iniciar Sesi√≥n</a>
                <a href="registro.html" id="register-link">Registrarse</a>
                <div id="user-info" style="display: none;">
                    <span id="user-name"></span>
                    <button id="logout-btn">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </nav>
    </header>

    <main class="cart-main">
        <div class="cart-container">
            <!-- Navegaci√≥n breadcrumb -->
            <nav class="breadcrumb">

            </nav>

            <div class="cart-header">
                <h1>üõí Carrito de Compras</h1>
                <p class="cart-subtitle">Gestiona las propiedades que deseas arrendar</p>
            </div>

            <!-- Contenido del carrito -->
            <div class="cart-content">
                <!-- Carrito vac√≠o -->
                <div id="empty-cart" class="empty-cart">
                    <div class="empty-cart-icon">üõí</div>
                    <h3>Tu carrito est√° vac√≠o</h3>
                    <p>¬°Explora nuestras propiedades y encuentra tu hogar ideal!</p>
                    <a href="propiedades.html" class="btn-browse-properties">Ver Propiedades</a>
                </div>

                <!-- Lista de items del carrito -->
                <div id="cart-items" class="cart-items" style="display: none;">
                    <div class="cart-items-header">
                        <h3>Propiedades seleccionadas</h3>
                        <button id="clear-cart" class="btn-clear-cart">Vaciar carrito</button>
                    </div>

                    <div id="cart-list" class="cart-list">
                        <!-- Los items del carrito se cargar√°n aqu√≠ din√°micamente -->
                    </div>

                    <!-- Resumen del carrito -->
                    <div class="cart-summary">
                        <div class="summary-row">
                            <span>Total de propiedades:</span>
                            <span id="total-items">0</span>
                        </div>
                        <div class="summary-row total-row">
                            <span>Total mensual estimado:</span>
                            <span id="total-price">$0</span>
                        </div>

                        <div class="cart-actions">
                            <button id="continue-shopping" class="btn-secondary">Seguir explorando</button>
                            <button id="proceed-payment" class="btn-primary">Pagar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de pago exitoso -->
        <div id="payment-success-modal" class="payment-modal" style="display: none;">
            <div class="modal-content">
                <div class="success-icon">‚úì </div>
                <h3>¬°Pago Realizado Exitosamente!</h3>
                <p>Tu pago ha sido procesado correctamente. Recibir√°s un correo de confirmaci√≥n pronto.</p>
                <div class="modal-actions">
                    <button id="close-modal" class="btn-primary">Continuar</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-logo">
                <div class="logo-section">
                    <h3>RENTFAGELU</h3>
                    <p>Tu hogar ideal te espera</p>
                </div>
            </div>

            <div class="footer-columns">

                <div class="footer-column">
                    <h4>Cuenta</h4>
                    <ul>
                        <li><a href="login.html">Iniciar sesi√≥n</a></li>
                        <li><a href="registro.html">Registrarse</a></li>
                        <li><a href="carrito.html">Mi carrito</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Contacto</h4>
                    <ul>
                        <li><a href="contacto.html">Contacto</a></li>
                        <li><a href="nosotros.html">Nosotros</a></li>
                        <li><a href="email:contacto@rentfagelu.cl">contacto@rentfagelu.cl</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Rentfagelu. Todos los derechos reservados. | Plataforma de arriendos en Santiago, Chile</p>
        </div>
    </footer>

    <script src="assets/script.js"></script>
    <script src="assets/auth.js"></script>
    <script src="assets/cart.js"></script>
    <script>
        // Funcionalidad del carrito de compras
        document.addEventListener('DOMContentLoaded', function () {
            loadCartItems();

            // Event listeners
            document.getElementById('clear-cart').addEventListener('click', clearCart);
            document.getElementById('continue-shopping').addEventListener('click', () => {
                window.location.href = 'propiedades.html';
            });
            document.getElementById('proceed-payment').addEventListener('click', processPayment);

            // Event listener para cerrar el modal
            document.getElementById('close-modal').addEventListener('click', closePaymentModal);
        });

        function loadCartItems() {
            // Simulaci√≥n de items en el carrito (en una aplicaci√≥n real, esto vendr√≠a de localStorage o una API)
            const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];

            if (cartItems.length === 0) {
                showEmptyCart();
            } else {
                showCartItems(cartItems);
            }

            updateCartBadge(cartItems.length);
        }

        function showEmptyCart() {
            document.getElementById('empty-cart').style.display = 'block';
            document.getElementById('cart-items').style.display = 'none';
        }

        function showCartItems(items) {
            document.getElementById('empty-cart').style.display = 'none';
            document.getElementById('cart-items').style.display = 'block';

            const cartList = document.getElementById('cart-list');
            cartList.innerHTML = '';

            let total = 0;

            items.forEach((item, index) => {
                const itemElement = createCartItemElement(item, index);
                cartList.appendChild(itemElement);

                // Calcular total (asumiendo que el precio est√° en formato "$X.XXX/mes")
                const price = parseInt(item.price.replace(/[^\d]/g, ''));
                total += price;
            });

            document.getElementById('total-items').textContent = items.length;
            document.getElementById('total-price').textContent = `$${total.toLocaleString()}/mes`;
        }

        function createCartItemElement(item, index) {
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
                <div class="cart-item-image">
                    <div class="placeholder-img">üè†</div>
                </div>
                <div class="cart-item-info">
                    <h4>${item.title || 'Propiedad sin nombre'}</h4>
                    <p class="item-location">üìç ${item.location || 'Ubicaci√≥n no especificada'}</p>
                    <p class="item-price">${item.price || '$0/mes'}</p>
                    <p class="item-duration">Duraci√≥n: ${item.months || 6} meses</p>
                </div>
                <div class="cart-item-actions">
                    <button onclick="removeCartItem(${index})" class="btn-remove-item">
                        üóëÔ∏è Eliminar
                    </button>
                </div>
            `;
            return div;
        }

        function removeCartItem(index) {
            let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
            cartItems.splice(index, 1);
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
            loadCartItems();
        }

        function clearCart() {
            if (confirm('¬øEst√°s seguro de que quieres vaciar el carrito?')) {
                localStorage.removeItem('cartItems');
                loadCartItems();
            }
        }

        function updateCartBadge(count) {
            const badge = document.querySelector('.cart-badge');
            if (badge) {
                badge.textContent = count;
            }
        }

        function processPayment() {
            const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];

            if (cartItems.length === 0) {
                alert('No hay items en el carrito para procesar el pago.');
                return;
            }

            // Simular procesamiento de pago (loading)
            const paymentBtn = document.getElementById('proceed-payment');
            const originalText = paymentBtn.textContent;
            paymentBtn.textContent = 'Procesando...';
            paymentBtn.disabled = true;

            // Simular delay de procesamiento
            setTimeout(() => {
                // Restablecer bot√≥n
                paymentBtn.textContent = originalText;
                paymentBtn.disabled = false;

                // Mostrar modal de √©xito
                showPaymentSuccessModal();

                // Limpiar carrito despu√©s del pago exitoso
                localStorage.removeItem('cartItems');

            }, 2000);
        }

        function showPaymentSuccessModal() {
            document.getElementById('payment-success-modal').style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevenir scroll
        }

        function closePaymentModal() {
            document.getElementById('payment-success-modal').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restaurar scroll

            // Recargar el carrito para mostrar estado vac√≠o
            loadCartItems();

            // Opcional: redirigir a la p√°gina principal
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 500);
        }
    </script>
</body>

</html>